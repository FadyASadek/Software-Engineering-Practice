<!doctype html>
<html>
  <head>
    <title>Cocorra Test Client</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.js"></script>
  </head>

  <body style="font-family: sans-serif; padding: 20px">
    <h2>ðŸ§ª Cocorra Chat Tester</h2>

    <div>
      <label>Token:</label><br />
      <input
        type="text"
        id="token"
        placeholder="Paste Bearer Token here..."
        style="width: 100%; padding: 5px"
      />
    </div>
    <br />
    <div>
      <label>Room ID:</label><br />
      <input
        type="text"
        id="roomId"
        placeholder="GUID..."
        style="width: 300px; padding: 5px"
      />
      <button onclick="joinRoom()">Join Room</button>
    </div>

    <hr />
    <h3>Logs:</h3>
    <ul id="messagesList"></ul>

    <script>
      var connection;

      async function joinRoom() {
        const token = document.getElementById("token").value;
        const roomId = document.getElementById("roomId").value;

        // 1. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„
        connection = new signalR.HubConnectionBuilder()
          .withUrl("https://localhost:7232/chatHub", {
            accessTokenFactory: () => token,
          })
          .configureLogging(signalR.LogLevel.Information)
          .build();

        // 2. Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ø³Ø§ÙŠÙ„ (Listeners)
        connection.on("UserJoined", (data) => {
          const li = document.createElement("li");
          li.textContent = `ðŸŸ¢ ${data.name} joined! (On Stage: ${data.isOnStage})`;
          li.style.color = "green";
          document.getElementById("messagesList").appendChild(li);
        });

        try {
          // 3. Ø¨Ø¯Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„
          await connection.start();
          log("Connected to SignalR!");

          // 4. Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© JoinRoom
          await connection.invoke("JoinRoom", roomId);
          log("JoinRoom request sent!");
        } catch (err) {
          log("Error: " + err.toString());
          console.error(err);
        }
      }

      function log(msg) {
        const li = document.createElement("li");
        li.textContent = msg;
        document.getElementById("messagesList").appendChild(li);
      }
    </script>
  </body>
</html>
